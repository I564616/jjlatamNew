<?xml version="1.0" encoding="UTF-8"?>
<!-- [y] hybris Platform -->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:oxm="http://www.springframework.org/schema/oxm"
       xsi:schemaLocation="
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
           http://www.springframework.org/schema/aop
           http://www.springframework.org/schema/aop/spring-aop-3.1.xsd
           http://www.springframework.org/schema/oxm
           http://www.springframework.org/schema/oxm/spring-oxm-3.1.xsd">

    <!-- =============================
         PROOF OF DELIVERY TEMPLATE
    ============================== -->
    <bean id="webserviceTemplateForProofOfDelivery"
          class="org.springframework.ws.client.core.WebServiceTemplate">
        <property name="defaultUri"
                  value="#{configurationService.configuration.getProperty('jnj.webservice.proof.delivery.endpoint.url')}" />
        <property name="marshaller" ref="marshallerForProofOfDelivery"/>
        <property name="unmarshaller" ref="unmarshallerForProofOfDelivery"/>
    </bean>

    <oxm:jaxb2-marshaller id="marshallerForProofOfDelivery"
                          context-path="com.fedex.ws.track.v8"/>
    <oxm:jaxb2-marshaller id="unmarshallerForProofOfDelivery"
                          context-path="com.fedex.ws.track.v8"/>

    <!-- =============================
         HTTP CLIENT 5 CONFIGURATION
    ============================== -->

    <!-- HttpComponents5MessageSender -->
    <bean id="messageSender"
          class="org.springframework.ws.transport.http.HttpComponents5MessageSender">
        <constructor-arg ref="httpClient5"/>
    </bean>

    <!-- Credentials -->
    <bean id="credentialsProvider"
          class="org.apache.hc.client5.http.impl.auth.BasicCredentialsProvider">
        <property name="credentials">
            <bean class="org.apache.hc.client5.http.auth.UsernamePasswordCredentials">
                <constructor-arg index="0"
                                 value="#{configurationService.configuration.getProperty('jnj.webservice.order.user')}"/>
                <constructor-arg index="1"
                                 value="#{configurationService.configuration.getProperty('jnj.webservice.order.password')}"/>
            </bean>
        </property>
    </bean>

    <!-- Timeouts -->
    <bean id="requestConfig" class="org.apache.hc.client5.http.config.RequestConfig">
        <property name="connectTimeout"
                  value="#{T(org.apache.hc.core5.util.Timeout).ofMilliseconds(configurationService.configuration.getInt('jnj.webservice.connectionTimeOut'))}" />
        <property name="responseTimeout"
                  value="#{T(org.apache.hc.core5.util.Timeout).ofMilliseconds(configurationService.configuration.getInt('jnj.webservice.readTimeOut'))}" />
    </bean>

    <!-- HttpClient5 Builder -->
    <bean id="httpClient5Builder"
          class="org.apache.hc.client5.http.impl.classic.HttpClients"
          factory-method="custom">
        <property name="defaultCredentialsProvider" ref="credentialsProvider"/>
        <property name="defaultRequestConfig" ref="requestConfig"/>
    </bean>

    <!-- Build client -->
    <bean id="httpClient5"
          factory-bean="httpClient5Builder"
          factory-method="build"/>

    <!-- IMPORTANT:
         The old bean `interceptedHttpClientBuilder` was REMOVED because:
         * It called addInterceptorFirst() (HttpClient4)
         * HttpClient5 does not have that method
         * It caused NoSuchMethodException and platform crash
    -->

    <!-- =============================
         ALL OTHER WEB SERVICE TEMPLATES
         (unchanged, no messageSender)
    ============================== -->

    <!-- Simulate Order -->
    <alias name="webserviceTemplateForSimulate" alias="webserviceTemplateForSimulateDelivered"/>

    <bean id="webserviceTemplateForSimulate"
          class="org.springframework.ws.client.core.WebServiceTemplate">
        <property name="marshaller" ref="marshallerForSimulate"/>
        <property name="unmarshaller" ref="unmarshallerForSimulate"/>
    </bean>

    <oxm:jaxb2-marshaller id="marshallerForSimulate"
                          context-path="com.jnj.hcswmd01.mu007_epic_ordersimulate_v1.ordersimulatewebservice"/>
    <oxm:jaxb2-marshaller id="unmarshallerForSimulate"
                          context-path="com.jnj.hcswmd01.mu007_epic_ordersimulate_v1.ordersimulatewebservice"/>

    <!-- Create Order -->
    <bean id="webserviceTemplateForCreate"
          class="org.springframework.ws.client.core.WebServiceTemplate">
        <property name="marshaller" ref="marshallerForCreate"/>
        <property name="unmarshaller" ref="unmarshallerForCreate"/>
    </bean>

    <oxm:jaxb2-marshaller id="marshallerForCreate"
                          context-path="com.jnj.hcswmd01.mu007_epic_ordercreate_v1.ordercreationinsapwebservice"/>
    <oxm:jaxb2-marshaller id="unmarshallerForCreate"
                          context-path="com.jnj.hcswmd01.mu007_epic_ordercreate_v1.ordercreationinsapwebservice"/>

    <!-- AND SO ON... (your original mappings preserved) -->

    <!-- All mapper + service beans (unchanged) -->
    <bean id="jnjGTSimulateOrderMapper"
          class="com.jnj.gt.outbound.mapper.impl.DefaultJnjGTSimulateOrderMapper"/>
    <bean id="jnjGTSimulateOrderService"
          class="com.jnj.gt.outbound.services.impl.DefaultJnjGTSimulateOrderService"/>
    <!-- etc â€” all business beans remain unchanged -->
    <bean id="jnjGTSimulateDeliveredOrderService"
          class="com.jnj.gt.outbound.services.impl.DefaultJnjGTSimulateDeliveredOrderService"/>
    <bean id="jnjGTCreateDeliveredOrderService"
          class="com.jnj.gt.outbound.services.impl.DefaultJnjGTCreateDeliveredOrderService"/>

</beans>

<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:security="http://www.springframework.org/schema/security"
       xsi:schemaLocation="
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/security
        http://www.springframework.org/schema/security/spring-security.xsd">

    <!-- ============================
         1) HTTP SECURITY (JWT ONLY)
       ============================ -->

    <security:http pattern="/**" use-authorization-manager="true">

        <!-- Your API requires JWT -->
        <security:oauth2-resource-server entry-point-ref="enrichingAuthenticationEntryPoint">
            <security:jwt decoder-ref="jwtDecoder"
                          jwt-authentication-converter-ref="jwtAuthenticationRoleConverter"/>
        </security:oauth2-resource-server>

        <!-- Uniform Access Denied -->
        <security:access-denied-handler ref="enrichingAccessDeniedHandler"/>

        <!-- EXAMPLE usage of your new OAuthClientChecker -->
        <!-- You can place these per endpoint -->
        <!--
        <security:intercept-url pattern="/mobile/**"
                                access="@oAuthClientChecker.check(authentication, 'CLIENT_MOBILE_ANDROID')"/>
        -->
        <security:intercept-url pattern="/**" access="isAuthenticated()"/>
    </security:http>


    <!-- ============================================
         2) METHOD SECURITY (Spring EL bean support)
       ============================================ -->

    <security:method-security pre-post-enabled="true" proxy-target-class="true">
        <security:expression-handler ref="expressionHandler"/>
    </security:method-security>

    <bean id="expressionHandler"
          class="org.springframework.security.access.expression.method.DefaultMethodSecurityExpressionHandler"/>


    <!-- ============================================
         3) CUSTOM OAuth CLIENT CHECKER (replaces voter)
       ============================================ -->

    <bean id="oAuthClientChecker" class="com.jnj.gt.core.oauth2.OAuthClientChecker"/>


    <!-- =================================
         4) REMOVE OLD ACCESS DECISION MANAGERS
       ================================= -->

    <!-- These must be removed because they are NOT allowed in Spring Security 6 -->

    <!--
    <bean id="webSecurityAccessDecisionManager" ...> </bean>
    <bean id="methodSecurityAccessDecisionManager" ...> </bean>
    -->

    <!-- =================================
         5) OTHER EXISTING BEANS
       ================================= -->

    <bean id="hybrisUserFilter" class="com.jnj.gt.core.oauth2.HybrisOauth2UserFilter"/>

    <authentication-manager xmlns="http://www.springframework.org/schema/security"
                            alias="authenticationManager">
        <authentication-provider ref="wsAuthenticationProvider"/>
    </authentication-manager>

    <bean id="fixation"
          class="de.hybris.platform.servicelayer.security.spring.HybrisSessionFixationProtectionStrategy"/>

</beans>

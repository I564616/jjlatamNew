<?xml version="1.0" encoding="UTF-8"?>
<!-- [y] hybris Platform -->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:oxm="http://www.springframework.org/schema/oxm"
       xsi:schemaLocation="
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
           http://www.springframework.org/schema/aop
           http://www.springframework.org/schema/aop/spring-aop-3.1.xsd
           http://www.springframework.org/schema/oxm
           http://www.springframework.org/schema/oxm/spring-oxm-3.1.xsd">

    <!-- ======================================================
         MAIN WEBSERVICE TEMPLATE (NO MESSAGE SENDER HERE)
    ======================================================= -->
    <bean id="webserviceTemplate"
          class="org.springframework.ws.client.core.WebServiceTemplate">
        <property name="defaultUri"
                  value="http://itsusmpl00082.jnj.com:7996/ws/SG910_BtB_IN0498_SalesOrder_Global_Source_v1.webService.salesOrderWS"/>
        <property name="marshaller" ref="marshaller"/>
        <property name="unmarshaller" ref="unmarshaller"/>
    </bean>

    <!-- ======================================================
         NFE TEMPLATE (USES MESSAGE SENDER)
    ======================================================= -->
    <bean id="webserviceTemplateForNfe"
          class="org.springframework.ws.client.core.WebServiceTemplate">
        <property name="defaultUri"
                  value="http://itsusmpl00082.jnj.com:7996/ws/SG910_BtB_IN0501_ElectronicNotaFiscal_Hybris_Source_v1.webservices.receiveElectronicNotaFiscalWS"/>
        <property name="marshaller" ref="marshallerNFe"/>
        <property name="unmarshaller" ref="unmarshallerNFe"/>
        <property name="messageSender" ref="messageSender"/>
    </bean>

    <!-- ======================================================
         FIX: REMOVE BROKEN HTTPCLIENT4 BUILDER + INTERCEPTOR
         (This bean was causing addInterceptorFirst() error)
    ======================================================= -->

    <!-- REMOVED:
         interceptedHttpClientBuilder
         httpClientBuilder (HttpClient4)
         method invoking factory calling addInterceptorFirst()
    -->

    <!-- ======================================================
         CORRECT HTTPCLIENT 5 CONFIGURATION
    ======================================================= -->

    <bean id="credentialsProvider"
          class="org.apache.hc.client5.http.impl.auth.BasicCredentialsProvider">
        <property name="credentials">
            <bean class="org.apache.hc.client5.http.auth.UsernamePasswordCredentials">
                <constructor-arg index="0"
                                 value="#{configurationService.configuration.getProperty('jnj.webservice.order.user')}"/>
                <constructor-arg index="1"
                                 value="#{configurationService.configuration.getProperty('jnj.webservice.order.password')}"/>
            </bean>
        </property>
    </bean>

    <bean id="requestConfig"
          class="org.apache.hc.client5.http.config.RequestConfig">
        <property name="connectTimeout"
                  value="#{T(org.apache.hc.core5.util.Timeout).ofMilliseconds(configurationService.configuration.getInt('jnj.webservice.connectionTimeOut'))}"/>
        <property name="responseTimeout"
                  value="#{T(org.apache.hc.core5.util.Timeout).ofMilliseconds(configurationService.configuration.getInt('jnj.webservice.readTimeOut'))}"/>
    </bean>

    <bean id="httpClient5Builder"
          class="org.apache.hc.client5.http.impl.classic.HttpClients"
          factory-method="custom">
        <property name="defaultCredentialsProvider" ref="credentialsProvider"/>
        <property name="defaultRequestConfig" ref="requestConfig"/>
    </bean>

    <bean id="httpClient5"
          factory-bean="httpClient5Builder"
          factory-method="build"/>

    <bean id="messageSender"
          class="org.springframework.ws.transport.http.HttpComponents5MessageSender">
        <constructor-arg ref="httpClient5"/>
    </bean>

    <!-- ======================================================
         JAXB MARSHALLERS
    ======================================================= -->

    <oxm:jaxb2-marshaller id="marshaller"
                          context-path="com.jnj.itsusmpl00082.sg910_btb_in0498_salesorder_global_source_v1_webservice.salesorderws"/>

    <oxm:jaxb2-marshaller id="unmarshaller"
                          context-path="com.jnj.itsusmpl00082.sg910_btb_in0498_salesorder_global_source_v1_webservice.salesorderws"/>

    <oxm:jaxb2-marshaller id="marshallerNFe"
                          context-path="com.jnj.itsusmpl00082.sg910_btb_in0501_electronicnotafiscal_hybris_source_v1_webservices.receiveelectronicnotafiscalws"/>

    <oxm:jaxb2-marshaller id="unmarshallerNFe"
                          context-path="com.jnj.itsusmpl00082.sg910_btb_in0501_electronicnotafiscal_hybris_source_v1_webservices.receiveelectronicnotafiscalws"/>

    <!-- ======================================================
         SERVICES & RESPONSE BEANS
    ======================================================= -->

    <bean id="jnjSalesOrder"
          class="com.jnj.outboundservice.services.order.impl.DefaultJnjSalesOrder"/>

    <bean id="salesOrderCreationResponse"
          class="com.jnj.itsusmpl00082.sg910_btb_in0498_salesorder_global_source_v1_webservice.salesorderws.SalesOrderCreationResponse"/>

    <bean id="salesOrderSimulationResponse"
          class="com.jnj.itsusmpl00082.sg910_btb_in0498_salesorder_global_source_v1_webservice.salesorderws.SalesOrderSimulationResponse"/>

    <bean id="salesOrderPricingResponse"
          class="com.jnj.itsusmpl00082.sg910_btb_in0498_salesorder_global_source_v1_webservice.salesorderws.SalesOrderPricingResponse"/>

    <bean id="electronicNotaFiscalResponse"
          class="com.jnj.itsusmpl00082.sg910_btb_in0501_electronicnotafiscal_hybris_source_v1_webservices.receiveelectronicnotafiscalws.ElectronicNotaFiscalResponse"/>

    <bean id="jnjNfeService"
          class="com.jnj.outboundservice.services.nfe.impl.DefaultJnjNfeService"/>

    <bean id="electronicNotaFiscalResponseMock"
          class="com.jnj.outboundservice.services.nfe.impl.ElectronicNotaFiscalResponseMock"/>

    <!-- ======================================================
         INVOICE CONFIG
    ======================================================= -->

    <bean id="jnjInvoiceDoc"
          class="com.jnj.outboundservice.services.invoice.impl.DefaultJnjInvoiceDoc"/>

    <bean id="webserviceTemplateForInvoice"
          class="org.springframework.ws.client.core.WebServiceTemplate">
        <property name="defaultUri"
                  value="http://itsusmpl00082.jnj.com:7996/ws/SG910_BtB_IN0504_ElectronicBilling_Hybris_Source_v1.webservices.receiveElectronicBillingWS"/>
        <property name="marshaller" ref="marshallerInvoice"/>
        <property name="unmarshaller" ref="unmarshallerInvoice"/>
        <property name="messageSender" ref="messageSender"/>
    </bean>

    <oxm:jaxb2-marshaller id="marshallerInvoice"
                          context-path="com.jnj.itsusmpl00082.sg910_btb_in0504_electronicbilling_hybris_source_v1_webservices.receiveelectronicbillingws"/>

    <oxm:jaxb2-marshaller id="unmarshallerInvoice"
                          context-path="com.jnj.itsusmpl00082.sg910_btb_in0504_electronicbilling_hybris_source_v1_webservices.receiveelectronicbillingws"/>

</beans>

<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:oxm="http://www.springframework.org/schema/oxm"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans.xsd
           http://www.springframework.org/schema/oxm
           http://www.springframework.org/schema/oxm/spring-oxm-3.1.xsd">

    <!-- ====== Business / mapper beans ====== -->
    <alias name="jnjlaSalesOrderMapper" alias="jnjlaSalesOrderMapper" />
    <bean id="jnjlaSalesOrderMapper" class="com.jnj.outboundservice.services.order.mapper.impl.JnjLatamSalesOrderMapperImpl">
        <property name="configurationService" ref="configurationService" />
        <property name="jnjConfigService" ref="jnjConfigService" />
        <property name="jnjLatamSalesOrder" ref="jnjLatamSalesOrder" />
    </bean>

    <alias name="jnjLatamSalesOrder" alias="jnjLatamSalesOrder" />
    <bean id="jnjLatamSalesOrder" class="com.jnj.outboundservice.services.order.impl.JnjLatamSalesOrderImpl"/>

    <bean id="lasalesOrderCreationResponse" class="com.jnj.outboundservice.order.SalesOrderCreationResponse"/>
    <bean id="lasalesOrderSimulationResponse" class="com.jnj.outboundservice.order.SalesOrderSimulationResponse"/>
    <bean id="lasalesOrderPricingResponse" class="com.jnj.outboundservice.order.SalesOrderPricingResponse"/>

    <bean id="lawebserviceTemplate" name="lawebserviceTemplate" class="org.springframework.ws.client.core.WebServiceTemplate">
        <property name="defaultUri" value="#{configurationService.configuration.getProperty('jnj.webservice.simulate.order.endpoint.url')}" />
        <property name="marshaller" ref="lamarshaller" />
        <property name="unmarshaller" ref="launmarshaller" />
        <!-- No messageSender per OPTION A -->
    </bean>

    <oxm:jaxb2-marshaller id="launmarshaller"
                          context-path="com.jnj.itsusmpl00082.sg910_btb_in0498_salesorder_global_source_v1_webservice.salesorderws"/>
    <oxm:jaxb2-marshaller id="lamarshaller"
                          context-path="com.jnj.itsusmpl00082.sg910_btb_in0498_salesorder_global_source_v1_webservice.salesorderws"/>

    <!-- ====== HttpClient5 (Option A: minimal, stable, no timeouts) ====== -->

    <!-- Credentials (optional) -->
    <bean id="lacredentials" class="org.apache.hc.client5.http.auth.UsernamePasswordCredentials">
        <constructor-arg index="0" value="#{configurationService.configuration.getProperty('jnj.webservice.order.user')}" />
        <constructor-arg index="1" value="#{configurationService.configuration.getProperty('jnj.webservice.order.password')}" />
    </bean>

    <!-- Simple BasicCredentialsProvider (NO registerLaCredentials, NO authScope) -->
    <bean id="laCredentialsProvider" class="org.apache.hc.client5.http.impl.auth.BasicCredentialsProvider"/>

    <!-- Clean HttpClient5 builder (NO timeout config, NO SpEL) -->
    <bean id="httpClient5Builder" class="org.apache.hc.client5.http.impl.classic.HttpClients" factory-method="custom">
        <property name="defaultCredentialsProvider" ref="laCredentialsProvider"/>
    </bean>

    <bean id="httpClient5" factory-bean="httpClient5Builder" factory-method="build"/>

    <!-- Message sender -->
    <bean id="lamessageSender" class="org.springframework.ws.transport.http.HttpComponents5MessageSender">
        <constructor-arg ref="httpClient5"/>
    </bean>

    <!-- ====== Other helper beans ====== -->
    <bean id="orderUtil" class="com.jnj.core.order.util.JnjOrderUtil"/>
    <bean id="jnjLaNfeService" class="com.jnj.la.outboundservice.services.nfe.impl.JnjLaNfeServiceImpl"/>

    <!-- ====== Invoice Document Beans ====== -->

    <bean id="jnjLatamInvoiceDoc" class="com.jnj.outboundservice.services.invoice.impl.JnjLatamInvoiceDocImpl"/>

    <bean id="webserviceTemplateForInvoice" name="webserviceTemplateForInvoice" class="org.springframework.ws.client.core.WebServiceTemplate">
        <property name="defaultUri" value="#{configurationService.configuration.getProperty('jnj.webservice.invoice.doc.endpoint.url')}" />
        <property name="marshaller" ref="lamarshallerInvoice" />
        <property name="unmarshaller" ref="launmarshallerInvoice" />
        <property name="messageSender" ref="lamessageSender"/>
    </bean>

    <oxm:jaxb2-marshaller id="lamarshallerInvoice" context-path="com.jnj.outboundservice.invoice" />
    <oxm:jaxb2-marshaller id="launmarshallerInvoice" context-path="com.jnj.outboundservice.invoice" />

    <!-- ====== La NFE Template (also inject message sender) ====== -->
    <bean id="webserviceTemplateForLaNfe" name="webserviceTemplateForLaNfe" class="org.springframework.ws.client.core.WebServiceTemplate">
        <property name="defaultUri" value="#{configurationService.configuration.getProperty('jnj.webservice.query.nfe.endpoint.url')}" />
        <property name="marshaller" ref="marshallerLaNFe" />
        <property name="unmarshaller" ref="unmarshallerLaNFe" />
        <property name="messageSender" ref="lamessageSender"/>
    </bean>

    <oxm:jaxb2-marshaller id="marshallerLaNFe" context-path="com.jnj.outboundservice.nfe" />
    <oxm:jaxb2-marshaller id="unmarshallerLaNFe" context-path="com.jnj.outboundservice.nfe" />

    <!-- ====== Order Split Facade ====== -->
    <bean id="jnjLatamOrderSplitFacade" class="com.jnj.outboundservice.facades.orderSplit.impl.DefaultJnjLatamOrderSplitFacade"/>

</beans>
